<div class="auth-page">
  <div class="auth-card">

    <header class="auth-header">
      <img src="assets/logo-pecafacil.png" class="auth-logo" alt="Logo" />
      <div class="auth-title-group">
        <h1>Cadastrar Usuário</h1>
        <p>Preencha os dados para criar sua conta</p>
      </div>
    </header>

    <form class="auth-form" (ngSubmit)="onSubmit()" #form="ngForm">

      <!-- Dados pessoais -->
      <div class="form-group">
        <label>Nome Completo</label>
        <input type="text"
               [(ngModel)]="fullName"
               name="fullName"
               required
               placeholder="Seu nome completo" />
      </div>

      <!-- CPF -->
      <div class="form-group">
        <label>CPF</label>

        <input type="text"
              [(ngModel)]="cpf"
              name="cpf"
              required
              placeholder="000.000.000-00"
              maxlength="14"
              (input)="formatarCPF(); validarCPF()" />

        <small *ngIf="cpfValido === false" class="invalid-text">
          CPF inválido
        </small>

        <small *ngIf="cpfExistente === true" class="invalid-text">
          Este CPF já está cadastrado
        </small>
      </div>

      <!-- Telefone -->
      <div class="form-group">
        <label>Telefone</label>

        <input type="text"
               [(ngModel)]="phone"
               name="phone"
               required
               placeholder="(00) 00000-0000"
               maxlength="15"
               (input)="formatarPhone()" />
      </div>

      <!-- Email -->
      <div class="form-group">
        <label>Email</label>
        <input type="email"
               [(ngModel)]="email"
               name="email"
               required
               placeholder="email@exemplo.com" />
      </div>

      <!-- Endereço -->
      <div class="form-group">
        <label>CEP</label>

        <input type="text"
               [(ngModel)]="cep"
               name="cep"
               required
               placeholder="00000-000"
               maxlength="9"
               (input)="formatarCEP()"
               (blur)="buscarCEP()" />
      </div>

      <div class="form-group">
        <label>Rua</label>
        <input type="text"
               [(ngModel)]="street"
               name="street"
               required />
      </div>

      <div class="form-row">
        <div class="form-group half">
          <label>Número</label>
          <input type="text"
                 [(ngModel)]="number"
                 name="number"
                 required />
        </div>

        <div class="form-group half">
          <label>Complemento</label>
          <input type="text"
                 [(ngModel)]="complement"
                 name="complement" />
        </div>
      </div>

      <div class="form-group">
        <label>Bairro</label>
        <input type="text"
               [(ngModel)]="district"
               name="district"
               required />
      </div>

      <div class="form-row">
        <div class="form-group half">
          <label>Cidade</label>
          <input type="text"
                 [(ngModel)]="city"
                 name="city"
                 required />
        </div>

        <div class="form-group half">
          <label>Estado</label>
          <input type="text"
                 maxlength="2"
                 [(ngModel)]="state"
                 name="state"
                 required />
        </div>
      </div>

      <!-- Acesso -->
      <div class="form-group">
        <label>Usuário</label>

        <input type="text"
               [(ngModel)]="username"
               name="username"
               required
               (blur)="verificarUsername()" />

        <small *ngIf="usernameExistente === true" class="invalid-text">
          Usuário já está em uso
        </small>
      </div>

      <div class="form-group">
        <label>Senha</label>
        <input type="password"
               [(ngModel)]="password"
               name="password"
               required />
      </div>

      <div class="form-group">
        <label>Perfil</label>
        <select [(ngModel)]="role" name="role">
          <option value="ROLE_USER">Usuário</option>
          <option value="ROLE_ADMIN">Administrador</option>
        </select>
      </div>

      <button class="btn-primary"
              [disabled]="loading || !form.form.valid || cpfValido === false || cpfExistente === true || usernameExistente === true">
        {{ loading ? 'Salvando...' : 'Cadastrar' }}
      </button>

      <p class="error" *ngIf="errorMessage">{{ errorMessage }}</p>

      <p class="link">
        Já tem conta?
        <a routerLink="/login">Fazer login</a>
      </p>

    </form>
  </div>
</div>
