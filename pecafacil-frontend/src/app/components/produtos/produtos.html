<div class="container">
  <h2>ðŸ“¦ Cadastro de Produtos</h2>

  <!--  Barra de Pesquisa -->
  <div class="search-bar">
    <input
      type="text"
      [(ngModel)]="filtro"
      name="filtro"
      placeholder="ðŸ”Ž Buscar por nome, descriÃ§Ã£o, fornecedor ou ID..."
      class="search-input"
      autocomplete="off"
    />
  </div>

  <!-- ðŸ“ FormulÃ¡rio -->
  <form (ngSubmit)="salvarProduto()" #produtoForm="ngForm" class="produto-form">

    <input type="text"
           placeholder=" Nome do produto"
           [(ngModel)]="novoProduto.nome"
           name="nome"
           required>

    <input type="text"
           placeholder=" DescriÃ§Ã£o do produto"
           [(ngModel)]="novoProduto.descricao"
           name="descricao"
           required>

    <input type="number"
           placeholder=" Digite o preÃ§o (R$)"
           [(ngModel)]="novoProduto.preco"
           name="preco"
           step="0.01"
           min="0"
           required>

    <input type="number"
           placeholder="Estoque mÃ­nimo"
           [(ngModel)]="novoProduto.estoqueMinimo"
           name="estoqueMinimo"
           required>

    <input type="number"
           placeholder=" Informe a quantidade em estoque"
           [(ngModel)]="novoProduto.quantidade"
           name="quantidade"
           min="0"
           required>

    <input type="text"
           placeholder=" Nome do fornecedor"
           [(ngModel)]="novoProduto.fornecedor"
           name="fornecedor"
           required>

    <input type="text"
           placeholder="Local de armazenamento (ex: A32)"
           [(ngModel)]="novoProduto.local"
           name="local"
           required>

    <button type="submit" class="btn-salvar"> Salvar</button>
  </form>

  <!-- ðŸ“‹ Tabela -->
  <table class="produtos-table">
    <thead>
    <tr>
      <th></th>
      <th>Local</th>
      <th>Nome</th>
      <th>DescriÃ§Ã£o</th>
      <th>PreÃ§o</th>
      <th>Qtd.</th>
      <th>Fornecedor</th>
    </tr>
    </thead>

    <tbody>
      <ng-container *ngFor="let p of produtosFiltrados">
        <tr>
          <td class="seta-cell">
            <button class="seta" (click)="p.expandido = !p.expandido">
              <span [innerHTML]="p.expandido ? '&#9660;' : '&#9654;'"></span>
            </button>
          </td>
          <td>{{ p.local || 'â€”' }}</td>
          <td>{{ p.nome }}</td>
          <td>{{ p.descricao }}</td>
          <td>{{ p.preco | currency:'BRL' }}</td>
          <td [ngClass]="{ 'baixo-estoque': p.quantidade < (p.estoqueMinimo || 0) }">
            {{ p.quantidade }}
          </td>
          <td>{{ p.fornecedor }}</td>
        </tr>

        <tr *ngIf="p.expandido" class="detalhes-row">
          <td colspan="7">
            <div class="detalhes">
              <p><strong>DescriÃ§Ã£o:</strong> {{ p.descricao }}</p>
              <p><strong>Fornecedor:</strong> {{ p.fornecedor }}</p>
              <p><strong>Ãšltima Entrada:</strong>
                {{ p.dataUltimaEntrada ? (p.dataUltimaEntrada | date:'dd/MM/yyyy HH:mm') : 'â€”' }}
              </p>
              <p><strong>Ãšltima SaÃ­da:</strong>
                {{ p.dataUltimaSaida ? (p.dataUltimaSaida | date:'dd/MM/yyyy HH:mm') : 'â€”' }}
              </p>

              <div class="acoes">
                <button class="btn entrada" (click)="entrada(p.id!)">Entrada</button>
                <button class="btn saida" (click)="saida(p.id!)">SaÃ­da</button>
                <button class="btn excluir" (click)="excluir(p.id!)">Excluir</button>
              </div>
            </div>
          </td>
        </tr>

      </ng-container>
    </tbody>
  </table>
</div>
